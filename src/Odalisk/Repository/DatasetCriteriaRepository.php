<?php

namespace Odalisk\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * DatasetCriteriaRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class DatasetCriteriaRepository extends EntityRepository
{

	public function getCriteria($dataset){

        $stmt = $this->getEntityManager()
             ->getConnection()
             ->prepare("
			SELECT * 
			FROM  `datasets` 
			WHERE  `id` = ".$dataset->getId().""
        		);

        $stmt->execute();
        $result = $stmt->fetch();

        
        $boolean_res = array();
        $null_value_key = array();

        foreach ($result as $key => $value) {

            if ($value === NULL) {
                $null_value_key[] = "$key";
            }
        }

        $boolean_res["isTitleAndSummary"] = TRUE;
        $boolean_res["isReleasedOn"] = TRUE;
        $boolean_res["isProvider"] = TRUE;
        $boolean_res["isLastUpdateOn"] = TRUE;
        $boolean_res["isOwner"] = TRUE;
        $boolean_res["isMaintainer"] = TRUE;
        $boolean_res["isGoodLicense"] = TRUE;
        //$boolean_res["isAtLeastOneGoodFormat"] = TRUE;

        if ( in_array("name", $null_value_key ) || in_array("summary", $null_value_key)  ) {
            $boolean_res["isTitleAndSummary"] = FALSE;
        }
        if ( in_array("owner", $null_value_key )) {
            $boolean_res["isOwner"] = FALSE;
        }
        if ( in_array("provider", $null_value_key )) {
            $boolean_res["isProvider"] = FALSE;
        }
        if ( in_array("last_updated_on", $null_value_key )) {
            $boolean_res["isLastUpdateOn"] = FALSE;
        }
        if ( in_array("maintainer", $null_value_key )) {
            $boolean_res["isMaintainer"] = FALSE;
        }
        if ( in_array("released_on", $null_value_key )) {
            $boolean_res["isReleasedOn"] = FALSE;
        }
        if ( in_array("released_on", $null_value_key )) {
            $boolean_res["isReleasedOn"] = FALSE;
        }
        if ( in_array("license", $null_value_key )) {
            $boolean_res["isGoodLicence"] = FALSE;
        }

        // License is good ?
        //echo getcwd()."/src/Odalisk/Resources/licences.json";
        //echo file_get_contents("src/Odalisk/Resources/licenses.json");

        //$licenses = json_decode(file_get_contents("src/Odalisk/Resources/licenses.json") );
        //print_r($licenses);
    }


    /*
    protected $is_good_license;
    /*
    protected $is_at_least_one_good_format;
    */
}
